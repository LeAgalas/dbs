# НИЯУ МИФИ. ИИКС. Лабораторная работа №1-1. «Построение модели данных». Воронков Андрей, Б20-505. 2023.
## Обзор предметной области

Рассматриваемая предметная область - магазин реэкспортер (перепродажи вещей). Имеется в виду веб-сайт или телеграм-канал, в котором будут перепродаваться вещи.
Каждая вещь имеет набор тегов (теги могут повторяться между вещами) и несколько фотографий.
Вещи закупаются в разных источниках и попадают на склады. Со складов вещи мы уже перепродаем на нашем сайте.
После покупки создается заказ, а за этим начинается доставка до клиента с ближайшего склада.
По завершении доставки клиент может оставить отзыв по самой доставке, так и публичный на странице самого товара.

## Диаграмма сущностей

![Диаграмма сущностей](https://github.com/LeAgalas/dbs/assets/52858908/6fa47241-e33d-4aec-9c85-f561cccac09b)

## Спецификация таблиц

### Item

| Название Поля | Тип | Описание | Первичный ключ? | Внешний ключ? |
| --- | --- | --- | --- | --- |
| id | int | Идентификатор | да | нет |
| name | text | Название товара | нет | нет |
| description | text | Описание товара | нет | нет |
| previous_buy_price | int | Предыдущая цена покупки | нет | нет |
| previous_buy_shop | string | Предыдущий магазин покупки | нет | нет |
| current_sell_price | int | Текущая цена продажи | нет | нет |

### ItemComments

| Название Поля | Тип | Описание | Первичный ключ? | Внешний ключ? |
| --- | --- | --- | --- | --- |
| id | int | Идентификатор | да | нет |
| item_id | int | Идентификатор товара | нет | Item.id |
| username | string | Имя пользователя | нет | нет |
| user_phone | string | Телефон пользователя | нет | нет |
| comment_body | text | Текст комментария | нет | нет |

### ItemPhoto

| Название Поля | Тип | Описание | Первичный ключ? | Внешний ключ? |
| --- | --- | --- | --- | --- |
| item_id | int | Идентификатор товара | да | Item.id |
| photo_link | string | Ссылка на фотографию | да | нет |

### ItemTagsLink

| Название Поля | Тип | Описание | Первичный ключ? | Внешний ключ? |
| --- | --- | --- | --- | --- |
| item_id | int | Идентификатор товара | да | Item.id |
| tag_id | int | Идентификатор тега | да | Tags.id |

### Tags

| Название Поля | Тип | Описание | Первичный ключ? | Внешний ключ? |
| --- | --- | --- | --- | --- |
| id | int | Идентификатор тега | да | нет |
| name | string | Название тега | нет | нет |
| description | text | Описание тега | нет | нет |

### ItemShop

| Название Поля | Тип | Описание | Первичный ключ? | Внешний ключ? |
| --- | --- | --- | --- | --- |
| id | int | Идентификатор | да | нет |
| item_id | int | Идентификатор товара | да | Item.id |
| name | string | Название магазина | нет | нет |
| link_to_shop | string | Ссылка на товар в магазине | нет | нет |
| trusted | bool | Можно ли доверять продавцу? | нет | нет |
| current_price | int | Текущая цена продажи | нет | нет |

### Storage

| Название Поля | Тип | Описание | Первичный ключ? | Внешний ключ? |
| --- | --- | --- | --- | --- |
| id | int | Идентификатор | да | нет |
| item_id | int | Идентификатор товара | да | Item.id |
| storage_name | string | Название склада | нет | нет |
| item_amount | int | Количество товара на складе| нет | нет |


### Orders

| Название Поля | Тип | Описание | Первичный ключ? | Внешний ключ? |
| --- | --- | --- | --- | --- |
| id | int | Идентификатор | да | нет |
| item_id | int | Идентификатор товара | да | Item.id |
| item_amount | int | Количество товара в заказе | нет | нет |
| item_sell_price | int | Цена продажи | нет | нет |
| username | string | Имя пользователя | нет | нет |
| delivery_location | string | Адрес доставки | нет | нет |
| is_delivered | bool | Уже доставлено? | нет | нет |
| delivery_date | string | Ожидаемая дата доставки | нет | нет |
| delivery_note | text | Пожелания к доставке | нет | нет |
| delivery_comment | text | Отзыв к доставке | нет | нет |

## Приложение
[SQL сценарий для создания таблиц в SQLite](./resellshop.sql)

## Доказательство 3 нормальной формы

### Первая нормальная форма

Отношение находится в 1НФ, если все его атрибуты являются простыми, все используемые домены должны содержать только скалярные значения. Не должно быть повторений строк в таблице.

Доказательство: Для массивов элементов используются вспомогательные таблицы, строки не повторяются (везде есть первичный ключ, который уникален).

### Вторая нормальная форма

Отношение находится во 2НФ, если оно находится в 1НФ и каждый не ключевой атрибут неприводимо зависит от Первичного Ключа(ПК).

Неприводимость означает, что в составе потенциального ключа отсутствует меньшее подмножество атрибутов, от которого можно также вывести данную функциональную зависимость.

Доказательство: от `id` нельзя вывести функциональную зависимость, а составные первичные ключи выбраны так, что они единственным образом определяют объект, который описан данным ключом. Связка `id` + `something_id` также не позволяет вывести функциональную зависимость от себя.

### Третья нормальная форма

Отношение находится в 3НФ, когда находится во 2НФ и каждый не ключевой атрибут нетранзитивно зависит от первичного ключа. Проще говоря, второе правило требует выносить все не ключевые поля, содержимое которых может относиться к нескольким записям таблицы в отдельные таблицы.

Доказательство: все не ключевые поля, которые относят к нескольким записям (например, теги) вынесены в отдельную таблицу. Где нужно созданы вспомогательные таблицы (например, ItemTagsLink).

## Заключение
Была смоделирована структура базы данных для магазина перепродажи товаров. Были описаны сущности, их атрибуты и связи между ними. Была построена диаграмма сущностей. Было доказано, что база данных находится в третьей нормальной форме. 
